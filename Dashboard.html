<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® SafetyTech AI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset & Base Styles - NO SCROLLING */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden !important; /* NO SCROLLING */
        }

        :root {
            --primary: #1a237e;
            --primary-light: #534bae;
            --secondary: #ff4081;
            --danger: #f44336;
            --warning: #ff9800;
            --success: #4caf50;
            --info: #2196f3;
            --dark: #121212;
            --light: #f5f5f5;
            --card-bg: #ffffff;
            --border: #e0e0e0;
            --shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            height: 100vh;
            width: 100vw;
            display: flex;
        }

        /* Dashboard Layout - Fixed Height */
        .dashboard-container {
            display: flex;
            width: 100%;
            height: 100vh;
            max-height: 100vh;
            overflow: hidden;
        }

        /* Sidebar - Fixed Height */
        .sidebar {
            background: linear-gradient(180deg, #0d1b2a 0%, #1b263b 100%);
            color: white;
            padding: 20px 15px;
            width: 280px;
            min-width: 280px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 5px 0 15px rgba(0,0,0,0.2);
            overflow-y: hidden;
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-light);
        }

        .logo i {
            font-size: 2rem;
            color: var(--secondary);
            margin-right: 12px;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, #ff4081, #ff9800);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .info-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }

        .info-card h3 {
            color: var(--secondary);
            margin-bottom: 12px;
            font-size: 1rem;
            display: flex;
            align-items: center;
        }

        .info-card h3 i {
            margin-right: 8px;
            font-size: 0.9rem;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 6px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.85rem;
        }

        .info-label {
            color: #aaa;
        }

        .info-value {
            color: white;
            font-weight: 600;
            text-align: right;
            max-width: 120px;
        }

        .vehicle-card { border-left-color: var(--secondary); }
        .driver-card { border-left-color: var(--info); }
        .emergency-card { border-left-color: var(--danger); }

        .contact-number {
            display: flex;
            align-items: center;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 10px;
            padding: 8px;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 6px;
        }

        .contact-number i {
            margin-right: 8px;
            color: var(--danger);
        }

        /* Main Content - Fixed Height, NO SCROLLING */
        .main-content {
            background: rgba(255,255,255,0.98);
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
            height: 60px;
            min-height: 60px;
        }

        .header h2 {
            color: var(--primary);
            font-size: 1.5rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-active {
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
        }

        .status-text {
            font-weight: 600;
            color: var(--success);
            font-size: 0.9rem;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Alert Banner - Fixed Position */
        .alert-banner {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            color: white;
            display: none;
            animation: slideIn 0.5s ease-out;
            height: 120px;
            min-height: 120px;
        }

        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .alert-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .alert-header i {
            font-size: 1.5rem;
            margin-right: 10px;
            animation: emergency-pulse 1s infinite;
        }

        @keyframes emergency-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .alert-header h3 {
            font-size: 1.2rem;
            font-weight: 700;
        }

        .alert-details {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 10px 0;
        }

        .alert-detail {
            background: rgba(255,255,255,0.1);
            padding: 8px;
            border-radius: 6px;
        }

        .alert-label {
            color: rgba(255,255,255,0.8);
            font-size: 0.75rem;
            margin-bottom: 3px;
        }

        .alert-value {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .alert-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .alert-btn {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-size: 0.8rem;
        }

        .alert-btn i { font-size: 0.9rem; }
        .btn-call { background: white; color: var(--danger); }
        .btn-sms { background: var(--success); color: white; }
        .btn-location { background: var(--info); color: white; }

        /* Main Content Grid - Fixed Height */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: auto auto 1fr;
            gap: 15px;
            flex: 1;
            overflow: hidden;
            height: calc(100vh - 250px);
        }

        /* Sensor Grid - Compact */
        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            grid-column: span 2;
            height: 150px;
        }

        .sensor-card {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 12px;
            box-shadow: var(--shadow);
            border-top: 3px solid;
            display: flex;
            flex-direction: column;
            height: 140px;
        }

        .sensor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .sensor-title {
            font-size: 0.9rem;
            color: var(--primary);
            font-weight: 600;
        }

        .sensor-icon {
            font-size: 1.2rem;
            color: var(--primary-light);
        }

        .sensor-value {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            margin: 5px 0;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sensor-status {
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: 600;
            text-align: center;
            font-size: 0.75rem;
            margin-bottom: 8px;
        }

        .status-normal { background: rgba(76, 175, 80, 0.1); color: var(--success); }
        .status-warning { background: rgba(255, 152, 0, 0.1); color: var(--warning); }
        .status-critical { 
            background: rgba(244, 67, 54, 0.1); 
            color: var(--danger);
            animation: alert-pulse 1s infinite;
        }

        @keyframes alert-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .sensor-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
            margin-top: auto;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
        }

        .detail-label { color: #666; }
        .detail-value { font-weight: 600; color: #333; }

        /* Camera & Location - Fixed Height */
        .camera-section, .location-section {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 15px;
            box-shadow: var(--shadow);
            border-top: 3px solid;
            display: flex;
            flex-direction: column;
            height: 220px;
        }

        .camera-section { border-top-color: var(--info); }
        .location-section { border-top-color: var(--success); }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .section-title {
            font-size: 1rem;
            color: var(--primary);
            font-weight: 600;
        }

        .section-status {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
            color: var(--success);
            font-size: 0.8rem;
        }

        .camera-container {
            position: relative;
            width: 100%;
            flex: 1;
            background: #000;
            border-radius: 6px;
            overflow: hidden;
        }

        #webcam-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .detection-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .detection-box {
            position: absolute;
            border: 2px solid var(--danger);
            background: rgba(244, 67, 54, 0.2);
            border-radius: 3px;
        }

        .detection-label {
            position: absolute;
            top: -20px;
            left: 0;
            background: var(--danger);
            color: white;
            padding: 2px 6px;
            border-radius: 2px;
            font-size: 0.65rem;
            font-weight: 600;
        }

        .location-container {
            width: 100%;
            flex: 1;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 10px;
            text-align: center;
        }

        .location-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: white;
            opacity: 0.9;
        }

        .current-location {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 6px;
            margin: 5px 0;
            width: 90%;
        }

        .location-name {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .location-address {
            font-size: 0.7rem;
            opacity: 0.9;
        }

        .location-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            width: 90%;
            margin-top: 10px;
        }

        .location-detail {
            background: rgba(255,255,255,0.1);
            padding: 6px;
            border-radius: 4px;
            text-align: center;
        }

        .detail-number {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .detail-label {
            font-size: 0.65rem;
            opacity: 0.8;
        }

        /* System Logs - Fixed Height */
        .logs-section {
            background: var(--dark);
            border-radius: 10px;
            padding: 15px;
            box-shadow: var(--shadow);
            color: white;
            border-top: 3px solid var(--warning);
            grid-column: span 2;
            display: flex;
            flex-direction: column;
            height: 180px;
        }

        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .logs-title {
            font-size: 1rem;
            color: var(--warning);
            font-weight: 600;
        }

        .logs-container {
            background: rgba(0,0,0,0.3);
            border-radius: 6px;
            padding: 10px;
            flex: 1;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
        }

        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: #ddd;
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .log-time {
            color: var(--warning);
            font-weight: 600;
            min-width: 55px;
            font-size: 0.7rem;
        }

        .log-content {
            flex: 1;
            word-break: break-word;
            font-size: 0.75rem;
        }

        .log-critical { color: #ff6b6b; }
        .log-warning { color: #ffd93d; }
        .log-info { color: #4ecdc4; }
        .log-success { color: #6bcf7f; }

        .log-controls {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .log-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
        }

        .log-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Responsive - NO SCROLLING */
        @media (max-width: 1200px) {
            .sensor-grid {
                grid-template-columns: repeat(2, 1fr);
                height: auto;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto;
            }
            
            .camera-section, .location-section {
                height: 200px;
            }
        }

        @media (max-width: 992px) {
            .dashboard-container {
                flex-direction: column;
                height: 100vh;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                min-height: auto;
                padding: 15px;
            }
            
            .main-content {
                height: calc(100vh - 400px);
            }
        }

        /* Custom Scrollbar for logs only */
        .logs-container::-webkit-scrollbar {
            width: 6px;
        }

        .logs-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        .logs-container::-webkit-scrollbar-thumb {
            background: var(--warning);
            border-radius: 3px;
        }

        /* Utility Classes */
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <i class="fas fa-shield-alt"></i>
                <h1>SafetyTech AI</h1>
            </div>
            
            <div class="info-card vehicle-card">
                <h3><i class="fas fa-car"></i> Vehicle Info</h3>
                <div class="info-item">
                    <span class="info-label">Vehicle:</span>
                    <span class="info-value" id="vehicle-name">Toyota Fortuner</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Model:</span>
                    <span class="info-value" id="vehicle-model">Legender 4x4</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Reg:</span>
                    <span class="info-value" id="vehicle-reg">DL 8C AB 1234</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Year:</span>
                    <span class="info-value" id="vehicle-year">2023</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Insurance:</span>
                    <span class="info-value" id="vehicle-insurance">ICICI Lombard</span>
                </div>
            </div>
            
            <div class="info-card driver-card">
                <h3><i class="fas fa-user"></i> Driver Info</h3>
                <div class="info-item">
                    <span class="info-label">Name:</span>
                    <span class="info-value" id="driver-name">Rajesh Kumar</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Age:</span>
                    <span class="info-value" id="driver-age">35</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Blood:</span>
                    <span class="info-value" id="driver-blood">O+</span>
                </div>
                <div class="info-item">
                    <span class="info-label">License:</span>
                    <span class="info-value" id="driver-license">DL1234567890</span>
                </div>
            </div>
            
            <div class="info-card emergency-card">
                <h3><i class="fas fa-phone-alt"></i> Emergency</h3>
                <div class="contact-number">
                    <i class="fas fa-mobile-alt"></i>
                    <span id="emergency-contact">+919629042258</span>
                </div>
                <div style="color: rgba(255,255,255,0.7); font-size: 0.7rem; margin-top: 8px;">
                    Will be auto-notified
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h2>Real-time Accident Detection</h2>
                <div class="status-indicator">
                    <div class="status-dot status-active"></div>
                    <span class="status-text">ACTIVE MONITORING</span>
                </div>
            </div>
            
            <!-- Emergency Alert -->
            <div class="alert-banner" id="alertBanner">
                <div class="alert-header">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>EMERGENCY ACCIDENT DETECTED!</h3>
                </div>
                
                <div class="alert-details">
                    <div class="alert-detail">
                        <div class="alert-label">Location</div>
                        <div class="alert-value" id="alert-location">Current Location</div>
                    </div>
                    <div class="alert-detail">
                        <div class="alert-label">Severity</div>
                        <div class="alert-value" id="alert-severity">CRITICAL</div>
                    </div>
                    <div class="alert-detail">
                        <div class="alert-label">Confidence</div>
                        <div class="alert-value" id="alert-confidence">92%</div>
                    </div>
                    <div class="alert-detail">
                        <div class="alert-label">Time</div>
                        <div class="alert-value" id="alert-time">Now</div>
                    </div>
                </div>
                
                <div class="alert-actions">
                    <button class="alert-btn btn-call" onclick="callEmergency()">
                        <i class="fas fa-phone"></i> Call
                    </button>
                    <button class="alert-btn btn-sms" onclick="sendEmergencySMS()">
                        <i class="fas fa-sms"></i> SMS
                    </button>
                    <button class="alert-btn btn-location" onclick="shareLocation()">
                        <i class="fas fa-map-marker-alt"></i> Location
                    </button>
                </div>
            </div>
            
            <!-- Content Grid -->
            <div class="content-grid">
                <!-- Sensor Cards -->
                <div class="sensor-grid">
                    <!-- Vision Card -->
                    <div class="sensor-card" style="border-top-color: var(--info);">
                        <div class="sensor-header">
                            <div class="sensor-title">Vision</div>
                            <div class="sensor-icon"><i class="fas fa-eye"></i></div>
                        </div>
                        <div class="sensor-value" id="vision-confidence">0%</div>
                        <div class="sensor-status status-normal" id="vision-status">INACTIVE</div>
                        <div class="sensor-details">
                            <div class="detail-row">
                                <span class="detail-label">Objects:</span>
                                <span class="detail-value" id="vision-objects">0</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Track:</span>
                                <span class="detail-value" id="vision-tracking">NO</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Audio Card -->
                    <div class="sensor-card" style="border-top-color: var(--warning);">
                        <div class="sensor-header">
                            <div class="sensor-title">Audio</div>
                            <div class="sensor-icon"><i class="fas fa-volume-up"></i></div>
                        </div>
                        <div class="sensor-value" id="audio-confidence">0%</div>
                        <div class="sensor-status status-normal" id="audio-status">NORMAL</div>
                        <div class="sensor-details">
                            <div class="detail-row">
                                <span class="detail-label">Event:</span>
                                <span class="detail-value" id="audio-event">NORMAL</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Impact:</span>
                                <span class="detail-value" id="audio-impact">0.00</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- G-Force Card -->
                    <div class="sensor-card" style="border-top-color: var(--danger);">
                        <div class="sensor-header">
                            <div class="sensor-title">G-Force</div>
                            <div class="sensor-icon"><i class="fas fa-bolt"></i></div>
                        </div>
                        <div class="sensor-value" id="gforce-value">1.0G</div>
                        <div class="sensor-status status-normal" id="gforce-status">NORMAL</div>
                        <div class="sensor-details">
                            <div class="detail-row">
                                <span class="detail-label">Max:</span>
                                <span class="detail-value" id="gforce-max">1.0G</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Impacts:</span>
                                <span class="detail-value" id="gforce-count">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fusion Card -->
                    <div class="sensor-card" style="border-top-color: var(--success);">
                        <div class="sensor-header">
                            <div class="sensor-title">Fusion</div>
                            <div class="sensor-icon"><i class="fas fa-link"></i></div>
                        </div>
                        <div class="sensor-value" id="fusion-score">0.000</div>
                        <div class="sensor-status status-normal" id="fusion-status">SAFE</div>
                        <div class="sensor-details">
                            <div class="detail-row">
                                <span class="detail-label">Status:</span>
                                <span class="detail-value" id="system-status">MON</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Alert:</span>
                                <span class="detail-value" id="alert-level">GREEN</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Camera Section -->
                <div class="camera-section">
                    <div class="section-header">
                        <div class="section-title">Live Webcam</div>
                        <div class="section-status">
                            <div class="status-dot status-active"></div>
                            <span id="camera-status">LIVE</span>
                        </div>
                    </div>
                    <div class="camera-container">
                        <video id="webcam-video" autoplay playsinline></video>
                        <div class="detection-overlay" id="detectionOverlay"></div>
                    </div>
                </div>
                
                <!-- Location Section -->
                <div class="location-section">
                    <div class="section-header">
                        <div class="section-title">Current Location</div>
                        <div class="section-status">
                            <div class="status-dot status-active"></div>
                            <span id="gps-status">GPS</span>
                        </div>
                    </div>
                    <div class="location-container">
                        <div class="location-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        
                        <div class="current-location">
                            <div class="location-name" id="current-location-name">Initializing...</div>
                            <div class="location-address" id="current-location-address">Getting location...</div>
                        </div>
                        
                        <div class="location-details">
                            <div class="location-detail">
                                <div class="detail-number" id="current-speed">0</div>
                                <div class="detail-label">km/h</div>
                            </div>
                            <div class="location-detail">
                                <div class="detail-number" id="nearest-help">5</div>
                                <div class="detail-label">Help ETA (min)</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Logs -->
                <div class="logs-section">
                    <div class="logs-header">
                        <div class="logs-title">System Logs</div>
                        <div class="section-status">
                            <div class="status-dot status-active"></div>
                            <span>LIVE</span>
                        </div>
                    </div>
                    <div class="logs-container" id="logsContainer">
                        <!-- Logs will appear here -->
                    </div>
                    <div class="log-controls">
                        <button class="log-btn" onclick="clearLogs()">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                        <button class="log-btn" onclick="testEmergency()">
                            <i class="fas fa-bolt"></i> Test
                        </button>
                        <button class="log-btn" onclick="resetSystem()">
                            <i class="fas fa-redo"></i> Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let webcamStream = null;
        let detectionInterval = null;
        let emergencyMode = false;
        let systemLogs = [];
        let currentLocation = { 
            name: "Getting location...",
            address: "Please allow location access",
            speed: 0,
            lat: null,
            lon: null
        };
        let locationWatchId = null;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeWebcam();
            initializeLocation();
            startMonitoring();
            
            // Add initial logs
            addLog("System starting...", "info");
            addLog("SafetyTech AI v8.0", "success");
            addLog("Vehicle: Toyota Fortuner", "info");
            addLog("Driver: Rajesh Kumar (O+)", "info");
            addLog("Emergency: +919629042258", "info");
            addLog("Webcam initializing...", "info");
            addLog("GPS location starting...", "info");
            addLog("All systems starting...", "info");
            addLog("Monitoring active", "success");
        });
        
        // Initialize webcam
        async function initializeWebcam() {
            try {
                const video = document.getElementById('webcam-video');
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        frameRate: { ideal: 20 }
                    } 
                });
                
                video.srcObject = stream;
                webcamStream = stream;
                
                document.getElementById('camera-status').textContent = 'LIVE';
                addLog("Webcam active", "success");
                
                // Start simulation
                startSimulationMode();
                
            } catch (error) {
                console.error('Webcam error:', error);
                addLog("Webcam: Simulation mode", "warning");
                document.getElementById('camera-status').textContent = 'SIM';
                document.getElementById('camera-status').style.color = '#ff9800';
                startSimulationMode();
            }
        }
        
        // Start simulation mode
        function startSimulationMode() {
            detectionInterval = setInterval(() => {
                simulateSensorData();
            }, 2000);
        }
        
        // Initialize location with accurate geocoding
        function initializeLocation() {
            if (navigator.geolocation) {
                // Get current position
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        currentLocation.lat = position.coords.latitude;
                        currentLocation.lon = position.coords.longitude;
                        currentLocation.speed = position.coords.speed ? (position.coords.speed * 3.6).toFixed(0) : 0;
                        
                        getAccurateLocationName(position.coords.latitude, position.coords.longitude);
                        addLog("GPS location acquired", "success");
                    },
                    (error) => {
                        handleLocationError(error);
                    },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
                
                // Watch position for updates
                locationWatchId = navigator.geolocation.watchPosition(
                    (position) => {
                        currentLocation.lat = position.coords.latitude;
                        currentLocation.lon = position.coords.longitude;
                        currentLocation.speed = position.coords.speed ? (position.coords.speed * 3.6).toFixed(0) : 0;
                        
                        getAccurateLocationName(position.coords.latitude, position.coords.longitude);
                        document.getElementById('current-speed').textContent = currentLocation.speed;
                    },
                    handleLocationError,
                    { enableHighAccuracy: true, maximumAge: 5000, timeout: 8000 }
                );
                
                document.getElementById('gps-status').textContent = 'GPS';
                document.getElementById('gps-status').style.color = '#4caf50';
                
            } else {
                addLog("GPS not supported", "warning");
                document.getElementById('gps-status').textContent = 'SIM';
                document.getElementById('gps-status').style.color = '#ff9800';
                simulateLocation();
            }
        }
        
        // Get accurate location name using reverse geocoding
        async function getAccurateLocationName(lat, lon) {
            try {
                // Use OpenStreetMap Nominatim API for reverse geocoding
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`
                );
                
                if (!response.ok) {
                    throw new Error('Geocoding API failed');
                }
                
                const data = await response.json();
                
                if (data && data.address) {
                    const address = data.address;
                    
                    // Build location name based on available address components
                    let locationName = "";
                    let locationAddress = "";
                    
                    // Try to get readable location name
                    if (address.road) {
                        locationName = address.road;
                        if (address.house_number) {
                            locationName = `${address.house_number}, ${locationName}`;
                        }
                    } else if (address.neighbourhood) {
                        locationName = address.neighbourhood;
                    } else if (address.suburb) {
                        locationName = address.suburb;
                    } else if (address.city || address.town || address.village) {
                        locationName = address.city || address.town || address.village;
                    }
                    
                    // Build full address
                    const addressParts = [];
                    if (address.road) addressParts.push(address.road);
                    if (address.neighbourhood) addressParts.push(address.neighbourhood);
                    if (address.suburb) addressParts.push(address.suburb);
                    if (address.city) addressParts.push(address.city);
                    if (address.state) addressParts.push(address.state);
                    if (address.postcode) addressParts.push(address.postcode);
                    if (address.country) addressParts.push(address.country);
                    
                    locationAddress = addressParts.join(", ");
                    
                    // Update location info
                    currentLocation.name = locationName || data.display_name.split(",")[0];
                    currentLocation.address = locationAddress || data.display_name;
                    
                    // Update UI
                    document.getElementById('current-location-name').textContent = currentLocation.name;
                    document.getElementById('current-location-address').textContent = currentLocation.address;
                    
                    // Calculate ETA based on location type (urban vs rural)
                    let eta = 5; // Default 5 minutes
                    if (address.road && address.city) {
                        // Urban area with roads and city
                        eta = Math.floor(Math.random() * 5) + 3; // 3-7 minutes
                    } else if (address.village || address.town) {
                        // Rural area
                        eta = Math.floor(Math.random() * 10) + 8; // 8-17 minutes
                    }
                    
                    document.getElementById('nearest-help').textContent = eta;
                    
                    // Add location log (only if location changed significantly)
                    const lastLog = systemLogs[systemLogs.length - 1];
                    if (!lastLog || !lastLog.message.includes(currentLocation.name)) {
                        addLog(`üìç Location: ${currentLocation.name}`, "info");
                    }
                    
                } else {
                    // Fallback to coordinates
                    currentLocation.name = `Lat: ${lat.toFixed(4)}, Lon: ${lon.toFixed(4)}`;
                    currentLocation.address = "Reverse geocoding failed";
                    updateLocationUI();
                }
                
            } catch (error) {
                console.error('Geocoding error:', error);
                // Fallback: Use coordinates
                currentLocation.name = `Lat: ${lat.toFixed(4)}, Lon: ${lon.toFixed(4)}`;
                currentLocation.address = `Coordinates: ${lat.toFixed(6)}, ${lon.toFixed(6)}`;
                updateLocationUI();
                addLog("Location: Using coordinates", "warning");
            }
        }
        
        // Update location UI
        function updateLocationUI() {
            document.getElementById('current-location-name').textContent = currentLocation.name;
            document.getElementById('current-location-address').textContent = currentLocation.address;
            document.getElementById('current-speed').textContent = currentLocation.speed || 0;
        }
        
        // Handle location error
        function handleLocationError(error) {
            console.error('Location error:', error);
            let errorMessage = "Location: ";
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += "Permission denied";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += "Position unavailable";
                    break;
                case error.TIMEOUT:
                    errorMessage += "Request timeout";
                    break;
                default:
                    errorMessage += "Unknown error";
            }
            
            addLog(errorMessage, "warning");
            document.getElementById('gps-status').textContent = 'SIM';
            document.getElementById('gps-status').style.color = '#ff9800';
            
            // Try to get approximate location via IP
            getLocationByIP();
        }
        
        // Get approximate location by IP as fallback
        async function getLocationByIP() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                if (response.ok) {
                    const data = await response.json();
                    currentLocation.name = data.city || "Unknown";
                    currentLocation.address = `${data.region || ""}, ${data.country_name || ""}`.trim();
                    currentLocation.lat = data.latitude;
                    currentLocation.lon = data.longitude;
                    
                    updateLocationUI();
                    addLog(`Location by IP: ${currentLocation.name}`, "info");
                } else {
                    simulateLocation();
                }
            } catch (error) {
                simulateLocation();
            }
        }
        
        // Simulate location updates (fallback)
        function simulateLocation() {
            const delhiLocations = [
                { 
                    name: "DLF Cyber City", 
                    address: "Gurugram, Haryana 122002",
                    lat: 28.4945, 
                    lon: 77.0885 
                },
                { 
                    name: "Connaught Place", 
                    address: "New Delhi, Delhi 110001",
                    lat: 28.6315, 
                    lon: 77.2167 
                },
                { 
                    name: "India Gate", 
                    address: "Rajpath, New Delhi 110001",
                    lat: 28.6129, 
                    lon: 77.2295 
                },
                { 
                    name: "Select Citywalk", 
                    address: "Saket, New Delhi 110017",
                    lat: 28.5284, 
                    lon: 77.2189 
                },
                { 
                    name: "Rajiv Chowk Metro", 
                    address: "Connaught Place, New Delhi",
                    lat: 28.6337, 
                    lon: 77.2203 
                },
                { 
                    name: "AIIMS Hospital", 
                    address: "Ansari Nagar, New Delhi 110029",
                    lat: 28.5673, 
                    lon: 77.2091 
                },
                { 
                    name: "Lodhi Road", 
                    address: "New Delhi, Delhi 110003",
                    lat: 28.5928, 
                    lon: 77.2279 
                }
            ];
            
            // Start with DLF Cyber City (from your screenshot)
            currentLocation.name = "DLF Cyber City";
            currentLocation.address = "Gurugram, Haryana";
            currentLocation.speed = 35;
            updateLocationUI();
            
            // Change location every 45 seconds
            setInterval(() => {
                const randomLoc = delhiLocations[Math.floor(Math.random() * delhiLocations.length)];
                currentLocation.name = randomLoc.name;
                currentLocation.address = randomLoc.address;
                currentLocation.lat = randomLoc.lat;
                currentLocation.lon = randomLoc.lon;
                currentLocation.speed = Math.floor(Math.random() * 60) + 20;
                
                updateLocationUI();
                
                // Random ETA based on location type
                let eta;
                if (randomLoc.name.includes("Hospital") || randomLoc.name.includes("Metro")) {
                    eta = Math.floor(Math.random() * 4) + 2; // 2-5 minutes
                } else {
                    eta = Math.floor(Math.random() * 8) + 3; // 3-10 minutes
                }
                document.getElementById('nearest-help').textContent = eta;
                
                addLog(`üìç Location: ${currentLocation.name}`, "info");
            }, 45000);
        }
        
        // Simulate all sensor data
        function simulateSensorData() {
            simulateVisionAnalysis();
            simulateAudioAnalysis();
            simulateGForceAnalysis();
            performSensorFusion();
        }
        
        // Simulate vision analysis
        function simulateVisionAnalysis() {
            const confidence = Math.min(0.1 + Math.random() * 0.9, 0.95);
            const objectCount = Math.floor(Math.random() * 6);
            const isAccident = Math.random() < 0.02; // 2% chance
            
            let event = "NORMAL";
            let statusClass = "status-normal";
            
            if (isAccident) {
                event = "CRASH";
                statusClass = "status-critical";
            } else if (confidence > 0.6 && objectCount > 2) {
                event = "WARNING";
                statusClass = "status-warning";
            }
            
            // Update UI
            document.getElementById('vision-confidence').textContent = Math.round(confidence * 100) + '%';
            document.getElementById('vision-status').textContent = event;
            document.getElementById('vision-status').className = `sensor-status ${statusClass}`;
            document.getElementById('vision-objects').textContent = objectCount;
            document.getElementById('vision-tracking').textContent = objectCount > 0 ? 'YES' : 'NO';
            
            // Update detection boxes
            updateDetectionBoxes(objectCount, isAccident);
            
            // Add log for accidents
            if (isAccident) {
                addLog(`üö® Vision: Accident detected!`, "critical");
            }
        }
        
        // Update detection boxes
        function updateDetectionBoxes(count, isAccident) {
            const overlay = document.getElementById('detectionOverlay');
            overlay.innerHTML = '';
            
            if (count > 0) {
                for (let i = 0; i < count; i++) {
                    const box = document.createElement('div');
                    box.className = 'detection-box';
                    
                    const width = 80 + Math.random() * 100;
                    const height = 60 + Math.random() * 80;
                    const left = Math.random() * (100 - (width/10));
                    const top = Math.random() * (100 - (height/10));
                    
                    box.style.width = width + 'px';
                    box.style.height = height + 'px';
                    box.style.left = left + '%';
                    box.style.top = top + '%';
                    
                    if (isAccident && i === 0) {
                        box.style.borderColor = '#f44336';
                        box.style.background = 'rgba(244, 67, 54, 0.3)';
                        
                        const label = document.createElement('div');
                        label.className = 'detection-label';
                        label.textContent = 'CRASH!';
                        box.appendChild(label);
                    }
                    
                    overlay.appendChild(box);
                }
            }
        }
        
        // Simulate audio analysis
        function simulateAudioAnalysis() {
            const events = ["NORMAL", "NORMAL", "NORMAL", "WARNING", "CRASH"];
            const weights = [0.75, 0.75, 0.75, 0.2, 0.05];
            
            let event = "NORMAL";
            let r = Math.random();
            let cumulative = 0;
            
            for (let i = 0; i < events.length; i++) {
                cumulative += weights[i];
                if (r < cumulative) {
                    event = events[i];
                    break;
                }
            }
            
            const confidence = event === "NORMAL" ? 
                Math.random() * 0.3 + 0.7 : Math.random() * 0.3 + 0.6;
            
            const impactScore = event === "CRASH" ? 
                (0.7 + Math.random() * 0.3).toFixed(2) : (Math.random() * 0.4).toFixed(2);
            
            // Update UI
            document.getElementById('audio-confidence').textContent = Math.round(confidence * 100) + '%';
            document.getElementById('audio-status').textContent = event;
            document.getElementById('audio-event').textContent = event;
            document.getElementById('audio-impact').textContent = impactScore;
            
            // Add status class
            const audioStatus = document.getElementById('audio-status');
            audioStatus.className = 'sensor-status';
            if (event === "CRASH") audioStatus.classList.add('status-critical');
            else if (event === "WARNING") audioStatus.classList.add('status-warning');
            else audioStatus.classList.add('status-normal');
            
            // Add log for crashes
            if (event === "CRASH") {
                addLog(`üéµ Audio: Crash sound detected`, "critical");
            }
        }
        
        // Simulate G-Force analysis
        function simulateGForceAnalysis() {
            let baseG = 1.0;
            const eventTypes = ["normal", "braking", "bump", "collision"];
            const eventProbabilities = [0.85, 0.1, 0.04, 0.01];
            
            let eventType = "normal";
            let r = Math.random();
            let cumulative = 0;
            
            for (let i = 0; i < eventTypes.length; i++) {
                cumulative += eventProbabilities[i];
                if (r < cumulative) {
                    eventType = eventTypes[i];
                    break;
                }
            }
            
            switch(eventType) {
                case "braking": baseG = 2.5 + Math.random() * 1.0; break;
                case "bump": baseG = 3.5 + Math.random() * 1.0; break;
                case "collision": baseG = 5.0 + Math.random() * 2.0; break;
            }
            
            // Update UI
            document.getElementById('gforce-value').textContent = baseG.toFixed(1) + 'G';
            
            const maxG = parseFloat(document.getElementById('gforce-max').textContent) || 0;
            if (baseG > maxG) {
                document.getElementById('gforce-max').textContent = baseG.toFixed(1) + 'G';
            }
            
            if (baseG > 3.0) {
                const count = parseInt(document.getElementById('gforce-count').textContent) || 0;
                document.getElementById('gforce-count').textContent = count + 1;
            }
            
            // Determine status
            let status = "NORMAL";
            let statusClass = "status-normal";
            
            if (baseG > 5.0) {
                status = "CRASH";
                statusClass = "status-critical";
                addLog(`‚ö° G-Force: Severe impact`, "critical");
            } else if (baseG > 3.5) {
                status = "IMPACT";
                statusClass = "status-warning";
                addLog(`‚ö° G-Force: Hard impact`, "warning");
            }
            
            document.getElementById('gforce-status').textContent = status;
            document.getElementById('gforce-status').className = `sensor-status ${statusClass}`;
        }
        
        // Perform sensor fusion
        function performSensorFusion() {
            const visionConf = parseInt(document.getElementById('vision-confidence').textContent) / 100;
            const audioConf = parseInt(document.getElementById('audio-confidence').textContent) / 100;
            const gforceVal = parseFloat(document.getElementById('gforce-value').textContent);
            
            let gforceContribution = 0;
            if (gforceVal > 5.0) gforceContribution = 0.9;
            else if (gforceVal > 3.5) gforceContribution = 0.7;
            else if (gforceVal > 2.5) gforceContribution = 0.4;
            else gforceContribution = 0.1;
            
            const visionEvent = document.getElementById('vision-status').textContent;
            const audioEvent = document.getElementById('audio-event').textContent;
            const gforceEvent = document.getElementById('gforce-status').textContent;
            
            const eventWeights = {
                "NORMAL": 0.1,
                "WARNING": 0.3,
                "IMPACT": 0.5,
                "CRASH": 0.9
            };
            
            const visionWeight = eventWeights[visionEvent] || 0.1;
            const audioWeight = eventWeights[audioEvent] || 0.1;
            const gforceWeight = eventWeights[gforceEvent] || 0.1;
            
            const fusionScore = (
                visionConf * visionWeight * 0.4 +
                audioConf * audioWeight * 0.35 +
                gforceContribution * gforceWeight * 0.25
            );
            
            // Determine overall status
            let status = "SAFE";
            let statusClass = "status-normal";
            let systemStatus = "MON";
            let alertLevel = "GREEN";
            
            if (fusionScore > 0.7) {
                status = "CRASH";
                statusClass = "status-critical";
                systemStatus = "EMERG";
                alertLevel = "RED";
                
                if (!emergencyMode) {
                    triggerEmergencyAlert();
                }
                
            } else if (fusionScore > 0.5) {
                status = "WARN";
                statusClass = "status-warning";
                systemStatus = "ALERT";
                alertLevel = "YELLOW";
            }
            
            // Update UI
            document.getElementById('fusion-score').textContent = fusionScore.toFixed(3);
            document.getElementById('fusion-status').textContent = status;
            document.getElementById('fusion-status').className = `sensor-status ${statusClass}`;
            document.getElementById('system-status').textContent = systemStatus;
            document.getElementById('alert-level').textContent = alertLevel;
            
            const alertLevelElement = document.getElementById('alert-level');
            if (alertLevel === "RED") {
                alertLevelElement.style.color = "#f44336";
            } else if (alertLevel === "YELLOW") {
                alertLevelElement.style.color = "#ff9800";
            } else {
                alertLevelElement.style.color = "#4caf50";
            }
        }
        
        // Start monitoring
        function startMonitoring() {
            addLog("Monitoring started", "success");
        }
        
        // Trigger emergency alert
        function triggerEmergencyAlert() {
            emergencyMode = true;
            
            // Update emergency panel
            document.getElementById('alertBanner').style.display = 'block';
            document.getElementById('alert-location').textContent = currentLocation.name;
            document.getElementById('alert-severity').textContent = 'CRITICAL';
            document.getElementById('alert-confidence').textContent = 
                (parseFloat(document.getElementById('fusion-score').textContent) * 100).toFixed(0) + '%';
            document.getElementById('alert-time').textContent = 'NOW';
            
            // Add emergency logs
            addLog("üö®üö® EMERGENCY ACCIDENT! üö®üö®", "critical");
            addLog(`üìç Location: ${currentLocation.name}`, "critical");
            addLog(`üìç Address: ${currentLocation.address}`, "critical");
            if (currentLocation.lat && currentLocation.lon) {
                addLog(`üìç Coordinates: ${currentLocation.lat.toFixed(6)}, ${currentLocation.lon.toFixed(6)}`, "critical");
            }
            addLog("üìû Alerting emergency services...", "critical");
            addLog("üöë Ambulance dispatched", "critical");
            addLog("üëÆ Police notified", "critical");
        }
        
        // Call emergency
        function callEmergency() {
            const locationInfo = currentLocation.lat && currentLocation.lon 
                ? `Latitude: ${currentLocation.lat.toFixed(6)}\nLongitude: ${currentLocation.lon.toFixed(6)}`
                : 'Coordinates not available';
                
            const message = `EMERGENCY CALL\n\nLocation: ${currentLocation.name}\nAddress: ${currentLocation.address}\n${locationInfo}\n\nConnecting to emergency services...`;
            addLog("üìû Calling emergency...", "critical");
            alert(message);
        }
        
        // Send SMS
        function sendEmergencySMS() {
            const locationCoords = currentLocation.lat && currentLocation.lon 
                ? `Coordinates: ${currentLocation.lat.toFixed(6)}, ${currentLocation.lon.toFixed(6)}`
                : 'Coordinates not available';
                
            const message = `ACCIDENT ALERT!\nLocation: ${currentLocation.name}\nAddress: ${currentLocation.address}\n${locationCoords}\nDriver: Rajesh Kumar (O+)\nVehicle: Toyota Fortuner (DL 8C AB 1234)\nSend help immediately!`;
            addLog("üì± Sending SMS...", "critical");
            alert(`SMS to +919629042258:\n\n${message}`);
        }
        
        // Share location
        function shareLocation() {
            const locationText = `${currentLocation.name}\n${currentLocation.address}\n${currentLocation.lat ? `Latitude: ${currentLocation.lat.toFixed(6)}` : ''}\n${currentLocation.lon ? `Longitude: ${currentLocation.lon.toFixed(6)}` : ''}`;
            
            navigator.clipboard.writeText(locationText).then(() => {
                addLog("üìç Location copied", "success");
                alert("Location copied to clipboard!");
            });
        }
        
        // Add log
        function addLog(message, type = "info") {
            const logsContainer = document.getElementById('logsContainer');
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            let typeClass = '';
            switch(type) {
                case 'critical': typeClass = 'log-critical'; break;
                case 'warning': typeClass = 'log-warning'; break;
                case 'success': typeClass = 'log-success'; break;
                default: typeClass = 'log-info';
            }
            
            logEntry.innerHTML = `
                <span class="log-time">${timeString}</span>
                <span class="log-content ${typeClass}">${message}</span>
            `;
            
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
            
            systemLogs.push({time: now, message: message, type: type});
            if (systemLogs.length > 50) systemLogs.shift();
        }
        
        // Clear logs
        function clearLogs() {
            document.getElementById('logsContainer').innerHTML = '';
            systemLogs = [];
            addLog("Logs cleared", "info");
        }
        
        // Test emergency
        function testEmergency() {
            if (confirm("Simulate emergency accident?")) {
                document.getElementById('vision-confidence').textContent = '95%';
                document.getElementById('vision-status').textContent = 'CRASH';
                document.getElementById('vision-status').className = 'sensor-status status-critical';
                document.getElementById('vision-objects').textContent = '3';
                
                document.getElementById('audio-confidence').textContent = '88%';
                document.getElementById('audio-status').textContent = 'CRASH';
                document.getElementById('audio-status').className = 'sensor-status status-critical';
                document.getElementById('audio-event').textContent = 'CRASH';
                document.getElementById('audio-impact').textContent = '0.85';
                
                document.getElementById('gforce-value').textContent = '6.5G';
                document.getElementById('gforce-status').textContent = 'CRASH';
                document.getElementById('gforce-status').className = 'sensor-status status-critical';
                
                performSensorFusion();
                addLog("TEST: Emergency simulation", "warning");
            }
        }
        
        // Reset system
        function resetSystem() {
            emergencyMode = false;
            document.getElementById('alertBanner').style.display = 'none';
            addLog("System reset", "info");
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                testEmergency();
            }
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                resetSystem();
            }
        });
    </script>
</body>
</html>